# Configuration

## Developer configuration

* Version control: [Git](https://git-scm.com/)
  * macOS: May require installation of [Xcode command line tools](https://developer.apple.com/xcode/features/) prior to installation of Git.
* IDE: [VS Code](https://code.visualstudio.com/), with [settings](https://dev.to/adamlombard/how-to-use-the-black-python-code-formatter-in-vscode-3lo0) for using Black to automatically format Python
* [Miniconda](https://docs.conda.io/en/latest/miniconda.html) (or [Anaconda](https://docs.anaconda.com/), as an alternative, as both support [conda](https://docs.conda.io/en/latest/) package manager)

### Create the environment

```bash
# verify conda is up-to-date
(base) $ conda update -n base -c defaults conda

# test: create and delete an example environment called sibltest
(base) $ conda env list # verify sibltest is absent
(base) $ conda create --name sibltest python=3.7 scipy matplotlib
(base) $ conda env list # verify sibtest is present
#
(base) $ conda env remove --name sibltest
(base) $ conda env list # verify sibltest is absent

# create the actual environment siblenv
(base) $ conda create --name siblenv python=3.8 black dash flake8 matplotlib notebook pytest pytest-cov seaborn scikit-image scipy
(base) $ conda activate siblenv
(siblenv) $ cd ~/sibl/cli/; pip install -e . # for xyfigure
(siblenv) $ cd ~/sibl/geo/; pip install -e . # for xyfigure PTG extension
```

### Create the environment configuration file

Based on [sharing an environment](https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html#sharing-an-environment) documentation, to make a configuration file that is *cross-platorm*, use

```bash
(siblenv) $ conda env export --from-history > environment.yml
```

The `environment.yml` file will contain the following

```yml
name: siblenv
channels:
  - defaults
dependencies:
  - python=3.8
  - black
  - dash
  - flake8
  - matplotlib
  - notebook
  - pytest
  - pytest-cov
  - seaborn
  - scikit-image
  - scipy
```

## User configuration

### Conda 

Conda is preferred to Pip for installation of most packages.  

Clients should create their conda virtual environment from the above server-generated [environment.yml](environment.yml) file using the following commands

```bash
(base) $ conda env create -f environment.yml
(base) $ conda env list  # verify the environment was installed
(base) $ conda activate siblenv
(siblenv) $
```

### Pip 

The `xyfigure` package is on the PyPI index but not on the conda index.

* Install `xyfigure` either from PyPI or the wheel file.
* Install `ptg` from the wheel file.

Install from a terminal via PyPI:

```bash
(siblenv) $ pip install xyfigure
```

Install from a wheel file.  
The file can be obtained from Chad directly, or 
from [here](https://pypi.org/project/xyfigure/#files).   Then

```bash
(siblenv) $ pip install --user xyfigure-0.0.n-py3-non-any.whl  # where 0.0.n is the version number
```

Verify installation: check that `xyfigure` is contained in the list generated by 

```bash
(siblenv) $ pip list
```

Update current install to the latest version:

```bash
(siblenv) $ pip install xyfigure --upgrade
```

To install a specific version, e.g., version `0.0.5`:

```bash
(siblenv) $ pip install --user xyfigure==0.0.5
```

## Updates

Here we demonstrate upgrading pip first, then upgrading the scikit-image package via pip.

```bash
python -m pip install --trusted-host pypi.org --trusted-host files.pythonhosted.org --upgrade pip
pip install scikit-image --upgrade
```

## Optional Installs (In Development)

Optional installs required for Qt application development:

```bash
(siblenv) $ pip install pyside2 # installed version 5.15.1 on 2020-04-14
(siblenv) $ pip install toyplot # installed version 0.019.0 on 2020-04-14
```

## Git

For an overview, [read the guide](https://guides.github.com/activities/hello-world/) from GitHub.

Get a local copy of the repository using `git clone` with SSH

```console
$ cd ~  # Starting from the home directory is optional, but recommended.
$ git clone git@github.com:sandialabs/sibl.git
```


In the `~/sibl/.git/config` file, add the following:

```python
[user]
    name = James Bond  # your first and last name
    email = jb007@company.com  # your email address
```

Configure ssh keys between your local and the repo.  This assumes to you have an existing public key file in `~/.ssh/id_rsa/id_rsa.pub`.  See [this](https://help.github.com/en/github/authenticating-to-github/connecting-to-github-with-ssh) to create a public key.  See [this](https://help.github.com/en/github/authenticating-to-github) for troubleshooting.

Copy the entire **public** key to the GitHub site under [Settings > SSH and GPG keys](https://github.com/settings/keys).

From within the repo `~/sibl/`, set the username and email on a *per-repo* basis:

```console
$ git config user.name "James Bond"  # your first and last name in quotations
$ git config user.email "jb007@company.com"  # your email address in quotations
```

## References

* Conda [build](https://docs.conda.io/projects/conda-build/en/latest/resources/build-scripts.html)
* Conda [managing environments](https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html)
* Conda [cheat sheet](https://docs.conda.io/projects/conda/en/4.6.0/_downloads/52a95608c49671267e40c689e0bc00ca/conda-cheatsheet.pdf)
* [Docker Hub](https://hub.docker.com/)
* [Pyschool](https://github.com/hovey/pyschool/blob/master/zfolder/doc/introduction.md) example deployment and a specific [configuration](https://github.com/hovey/pyschool/blob/master/zfolder/doc/configuration.md) example.
